<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rt2_assignment2: src/state_machine.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rt2_assignment2
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Package for the 2nd assignment for the RT2 course</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">state_machine.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains a state machine to start or stop the random beahvior of the robot.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;ros/ros.h&quot;</code><br />
<code>#include &quot;rt2_assignment1/Command.h&quot;</code><br />
<code>#include &quot;rt2_assignment1/RandomPosition.h&quot;</code><br />
<code>#include &quot;rt2_assignment1/PlanningAction.h&quot;</code><br />
<code>#include &lt;actionlib/client/simple_action_client.h&gt;</code><br />
<code>#include &quot;std_msgs/Bool.h&quot;</code><br />
<code>#include &quot;std_msgs/Time.h&quot;</code><br />
<code>#include &quot;std_msgs/Duration.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for state_machine.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="state__machine_8cpp__incl.png" border="0" usemap="#src_2state__machine_8cpp" alt=""/></div>
<map name="src_2state__machine_8cpp" id="src_2state__machine_8cpp">
<area shape="rect" title="This file contains a state machine to start or stop the random beahvior of the robot." alt="" coords="738,5,906,32"/>
<area shape="rect" title=" " alt="" coords="5,87,84,114"/>
<area shape="rect" title=" " alt="" coords="108,87,323,114"/>
<area shape="rect" title=" " alt="" coords="347,87,601,114"/>
<area shape="rect" title=" " alt="" coords="625,80,816,121"/>
<area shape="rect" title=" " alt="" coords="840,80,1007,121"/>
<area shape="rect" title=" " alt="" coords="1031,87,1160,114"/>
<area shape="rect" title=" " alt="" coords="1184,87,1316,114"/>
<area shape="rect" title=" " alt="" coords="1340,87,1496,114"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1a9543636935547580c0657f4c7c0c2b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state__machine_8cpp.html#a1a9543636935547580c0657f4c7c0c2b">user_interface</a> (rt2_assignment1::Command::Request &amp;req, rt2_assignment1::Command::Response &amp;res)</td></tr>
<tr class="memdesc:a1a9543636935547580c0657f4c7c0c2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the /user_interface callback.  <a href="state__machine_8cpp.html#a1a9543636935547580c0657f4c7c0c2b">More...</a><br /></td></tr>
<tr class="separator:a1a9543636935547580c0657f4c7c0c2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="state__machine_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function of the node.  <a href="state__machine_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab376b87f96a574a793c03c53e75afec8"><td class="memItemLeft" align="right" valign="top"><a id="ab376b87f96a574a793c03c53e75afec8"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>start</b> = false</td></tr>
<tr class="separator:ab376b87f96a574a793c03c53e75afec8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bbd5ff52abed3e07aa5205f1179d9d3"><td class="memItemLeft" align="right" valign="top"><a id="a4bbd5ff52abed3e07aa5205f1179d9d3"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>stopped</b> = true</td></tr>
<tr class="separator:a4bbd5ff52abed3e07aa5205f1179d9d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2146b68266adcceb07812782387843de"><td class="memItemLeft" align="right" valign="top"><a id="a2146b68266adcceb07812782387843de"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>total_seconds</b> = 0</td></tr>
<tr class="separator:a2146b68266adcceb07812782387843de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e7b2b403f58b3a7ebedb4501612fae7"><td class="memItemLeft" align="right" valign="top"><a id="a4e7b2b403f58b3a7ebedb4501612fae7"></a>
std_msgs::Bool&#160;</td><td class="memItemRight" valign="bottom"><b>reached</b></td></tr>
<tr class="separator:a4e7b2b403f58b3a7ebedb4501612fae7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e9ef032fe365beb7da79da8b09a844e"><td class="memItemLeft" align="right" valign="top"><a id="a3e9ef032fe365beb7da79da8b09a844e"></a>
ros::Time&#160;</td><td class="memItemRight" valign="bottom"><b>start_timer</b></td></tr>
<tr class="separator:a3e9ef032fe365beb7da79da8b09a844e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbd07d46dd4add76d2584c66250288f1"><td class="memItemLeft" align="right" valign="top"><a id="afbd07d46dd4add76d2584c66250288f1"></a>
ros::Time&#160;</td><td class="memItemRight" valign="bottom"><b>stop_timer</b></td></tr>
<tr class="separator:afbd07d46dd4add76d2584c66250288f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50f71d98d1e31f81025b23107a197492"><td class="memItemLeft" align="right" valign="top"><a id="a50f71d98d1e31f81025b23107a197492"></a>
std_msgs::Duration&#160;</td><td class="memItemRight" valign="bottom"><b>tempo</b></td></tr>
<tr class="separator:a50f71d98d1e31f81025b23107a197492"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains a state machine to start or stop the random beahvior of the robot. </p>
<dl class="section author"><dt>Author</dt><dd>Maria Luisa Aiachini</dd></dl>
<p>Services: <br  />
 °/user_interface</p>
<p>Clients: <br  />
 °/position_server</p>
<p>Action Client: <br  />
 °/go_to_point</p>
<p>Publishes to: <br  />
 °/reached °/duration</p>
<p>Description:</p>
<p>This node is used for starting or stopping the robot random behavior. It receives a request from the /user_interface with a command: 'start' or 'stop'. If the robot needs to start, the node sends a request to the /position_server with the min and the max values to obtain a position that will be reached. When the node receives a response it sends the target position to the /go_to_point server that will make the robot move; at the same time a timer is started to compute the total time needed to reach the goal. Once the robot reaches the goal, this information is published on the topic /reached and the time needed is computed and published on the topic /duration. Finally, if the node has not received a 'stop' command from the /user_interface, another target is computed and the behavior will start again. If the node receives a 'stop' command at any time, the goal is cancelled and the robot is stopped immediately. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function of the node. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td></td></tr>
    <tr><td class="paramname">argv</td><td>In this function the node is initiated, and there are all the definitions for the services, clients, action clients, and publishers. This function behavior depends on the value of global variable 'state' and, also, depending on the variable 'stopped' that indicates if the robot, before the 'start' command, was moving or not. If the robot was stopped the node will send a request to the random position to receive a target position to be reached, and sends this position through the action service /go_to_point to make the robot move, also it sets the variable 'stopped' to false. At this point when the target is reached it is published on /reached and printed on the terminal, also the time needed is published on the /duration topic. If the user interface sends the command 'stop', at any moment, the goal is cancelled and this is published on the /reached topic. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1a9543636935547580c0657f4c7c0c2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a9543636935547580c0657f4c7c0c2b">&#9670;&nbsp;</a></span>user_interface()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool user_interface </td>
          <td>(</td>
          <td class="paramtype">rt2_assignment1::Command::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rt2_assignment1::Command::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for the /user_interface callback. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">&amp;req</td><td>request of the client </td></tr>
    <tr><td class="paramname">&amp;res</td><td>response for the client</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>always true</dd></dl>
<p>This function is the callback for the /user_interface service. Here it takes the command from the user interface and assigns it to a global varialble 'start' </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
